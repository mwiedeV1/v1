
	<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
	<html xmlns="http://www.w3.org/1999/xhtml">
	
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />	
		<title>V1 Script - SSL Client</title>
		<link rel="stylesheet" type="text/css" href="css/style.css" />
	</head>
	
	<body>
	
	<div class="logo"><a href="index.html"><img src="images/v1_logo.png" alt="V1 Script"/></a></div>
	
	<div class="page_wrap">
	<h1>Example: TLS/SSL Client</h1>
<p>Demonstrates how to establish a SSL connection with <a href="module-ssl.html">ssl module</a> based on OpenSSL.</p>
<pre><code><span style="color: #000000"></span><span style="color: #0000BB;">&lt;?</span><span style="color: #000000">v1<br /><br />dl&nbsp;</span><span style="color: #0000BB;">(</span><span style="color: #DD0000">"ssl"</span><span style="color: #0000BB;">);&nbsp;</span><span style="color: #008000">//&nbsp;Load&nbsp;ssl&nbsp;module<br /><br /></span><span style="color: #000000">host&nbsp;</span><span style="color: #0000BB;">=&nbsp;</span><span style="color: #DD0000">"v1-script.net"</span><span style="color: #0000BB;">;<br />print&nbsp;(</span><span style="color: #DD0000">"Connect&nbsp;to&nbsp;"</span><span style="color: #0000BB;">,&nbsp;</span><span style="color: #000000">host</span><span style="color: #0000BB;">);<br /><br /></span><span style="color: #008000">//&nbsp;Create&nbsp;classic&nbsp;socket<br /></span><span style="color: #000000">socket&nbsp;</span><span style="color: #0000BB;">=&nbsp;</span><span style="color: #000000">fsockopen&nbsp;</span><span style="color: #0000BB;">(</span><span style="color: #000000">host</span><span style="color: #0000BB;">,&nbsp;</span><span style="color: #000000">443</span><span style="color: #0000BB;">);<br /><br />if&nbsp;(</span><span style="color: #000000">socket</span><span style="color: #0000BB;">)&nbsp;{<br />&nbsp;&nbsp;</span><span style="color: #008000">//&nbsp;Create&nbsp;SSL&nbsp;Context<br />&nbsp;&nbsp;</span><span style="color: #000000">ctx&nbsp;</span><span style="color: #0000BB;">=&nbsp;</span><span style="color: #000000">SSL_CTX_new&nbsp;</span><span style="color: #0000BB;">();<br /><br />&nbsp;&nbsp;</span><span style="color: #000000">SSL_CTX_set_options&nbsp;</span><span style="color: #0000BB;">(</span><span style="color: #000000">ctx</span><span style="color: #0000BB;">,&nbsp;</span><span style="color: #000000">SSL_FLAG</span><span style="color: #0000BB;">(</span><span style="color: #DD0000">"SSL_OP_NO_SSLv3"</span><span style="color: #0000BB;">));<br /><br />&nbsp;&nbsp;</span><span style="color: #000000">printf&nbsp;</span><span style="color: #0000BB;">(</span><span style="color: #DD0000">"SSL_CTX_set_options&nbsp;Flags&nbsp;=&nbsp;0x%.8x"</span><span style="color: #0000BB;">,&nbsp;</span><span style="color: #000000">SSL_CTX_get_options&nbsp;</span><span style="color: #0000BB;">(</span><span style="color: #000000">ctx</span><span style="color: #0000BB;">));<br /><br />&nbsp;&nbsp;</span><span style="color: #008000">//&nbsp;Create&nbsp;SSL<br />&nbsp;&nbsp;</span><span style="color: #000000">ssl&nbsp;</span><span style="color: #0000BB;">=&nbsp;</span><span style="color: #000000">SSL_new&nbsp;</span><span style="color: #0000BB;">(</span><span style="color: #000000">ctx</span><span style="color: #0000BB;">);<br />&nbsp;&nbsp;</span><span style="color: #000000">SSL_set_cipher_list&nbsp;</span><span style="color: #0000BB;">(</span><span style="color: #000000">ssl</span><span style="color: #0000BB;">,&nbsp;</span><span style="color: #DD0000">"HIGH:!aNULL:!kRSA:!PSK:!SRP:!MD5:!RC4"</span><span style="color: #0000BB;">);<br /><br />&nbsp;&nbsp;</span><span style="color: #008000">//&nbsp;Set&nbsp;socket<br />&nbsp;&nbsp;</span><span style="color: #000000">SSL_set_fd&nbsp;</span><span style="color: #0000BB;">(</span><span style="color: #000000">ssl</span><span style="color: #0000BB;">,&nbsp;</span><span style="color: #000000">socket</span><span style="color: #0000BB;">);<br /><br />&nbsp;&nbsp;</span><span style="color: #008000">//&nbsp;Connect&nbsp;SSL<br />&nbsp;&nbsp;</span><span style="color: #0000BB;">if&nbsp;(</span><span style="color: #000000">SSL_connect&nbsp;</span><span style="color: #0000BB;">(</span><span style="color: #000000">ssl</span><span style="color: #0000BB;">,&nbsp;</span><span style="color: #000000">host</span><span style="color: #0000BB;">))&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000">//&nbsp;Print&nbsp;certificate&nbsp;information<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB;">print&nbsp;(</span><span style="color: #DD0000">"\r\nCertificate:"</span><span style="color: #0000BB;">);&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">cert&nbsp;</span><span style="color: #0000BB;">=&nbsp;</span><span style="color: #000000">SSL_get_peer_certificate&nbsp;</span><span style="color: #0000BB;">(</span><span style="color: #000000">ssl</span><span style="color: #0000BB;">);<br />&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #000000">cert&nbsp;</span><span style="color: #0000BB;">as&nbsp;</span><span style="color: #000000">key&nbsp;</span><span style="color: #0000BB;">=&gt;&nbsp;</span><span style="color: #000000">data</span><span style="color: #0000BB;">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #000000">is_array&nbsp;</span><span style="color: #0000BB;">(</span><span style="color: #000000">data</span><span style="color: #0000BB;">))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;(</span><span style="color: #000000">key</span><span style="color: #0000BB;">.</span><span style="color: #DD0000">"&nbsp;=&nbsp;"</span><span style="color: #0000BB;">.</span><span style="color: #000000">data</span><span style="color: #0000BB;">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #000000">data&nbsp;</span><span style="color: #0000BB;">as&nbsp;</span><span style="color: #000000">key2&nbsp;</span><span style="color: #0000BB;">=&gt;&nbsp;</span><span style="color: #000000">value2</span><span style="color: #0000BB;">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;(</span><span style="color: #000000">key</span><span style="color: #0000BB;">.</span><span style="color: #DD0000">":"</span><span style="color: #0000BB;">.</span><span style="color: #000000">key2</span><span style="color: #0000BB;">.</span><span style="color: #DD0000">"&nbsp;=&nbsp;"</span><span style="color: #0000BB;">.</span><span style="color: #000000">value2</span><span style="color: #0000BB;">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000">//&nbsp;Print&nbsp;ciphers<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB;">print&nbsp;(</span><span style="color: #DD0000">"\r\nCiphers:"</span><span style="color: #0000BB;">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;(</span><span style="color: #000000">SSL_get_cipher_list&nbsp;</span><span style="color: #0000BB;">(</span><span style="color: #000000">ssl</span><span style="color: #0000BB;">));<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000">//&nbsp;Write&nbsp;HTTP&nbsp;header<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">SSL_write&nbsp;</span><span style="color: #0000BB;">(</span><span style="color: #000000">ssl</span><span style="color: #0000BB;">,&nbsp;</span><span style="color: #DD0000">"GET&nbsp;/&nbsp;HTTP/1.1\r\nHost:&nbsp;"</span><span style="color: #0000BB;">.</span><span style="color: #000000">host</span><span style="color: #0000BB;">.</span><span style="color: #DD0000">"\r\nConnection:&nbsp;close\r\n\r\n"</span><span style="color: #0000BB;">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000">//&nbsp;Read&nbsp;header<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB;">print&nbsp;(</span><span style="color: #DD0000">"\r\nHTTP-Header:"</span><span style="color: #0000BB;">);&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">str&nbsp;</span><span style="color: #0000BB;">=&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #0000BB;">;<br />&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(</span><span style="color: #000000">SSL_readln&nbsp;</span><span style="color: #0000BB;">(</span><span style="color: #000000">ssl</span><span style="color: #0000BB;">,&nbsp;</span><span style="color: #000000">str</span><span style="color: #0000BB;">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;(</span><span style="color: #000000">str</span><span style="color: #0000BB;">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #000000">str</span><span style="color: #0000BB;">==</span><span style="color: #DD0000">""</span><span style="color: #0000BB;">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;}<br />&nbsp;&nbsp;</span><span style="color: #008000">//&nbsp;Free&nbsp;SSL<br />&nbsp;&nbsp;</span><span style="color: #000000">SSL_free&nbsp;</span><span style="color: #0000BB;">(</span><span style="color: #000000">ssl</span><span style="color: #0000BB;">);<br /><br />&nbsp;&nbsp;</span><span style="color: #008000">//&nbsp;Free&nbsp;SSL&nbsp;Context<br />&nbsp;&nbsp;</span><span style="color: #000000">SSL_CTX_free&nbsp;</span><span style="color: #0000BB;">(</span><span style="color: #000000">ctx</span><span style="color: #0000BB;">);<br /><br />&nbsp;&nbsp;</span><span style="color: #008000">//&nbsp;Close&nbsp;original&nbsp;socket<br />&nbsp;&nbsp;</span><span style="color: #000000">fclose&nbsp;</span><span style="color: #0000BB;">(</span><span style="color: #000000">socket</span><span style="color: #0000BB;">);<br />}<br /><br /></span><span style="color: #000000">?&gt;</span></code></pre>
<p><a href="index.html">back to Home</a></p>
	</div>
	<footer>
		<p>V1 Version 0.96 - Documentation generated Tue, 05 Sep 2023 11:27</p>
	</footer>
	</body>
	</html>
	
	