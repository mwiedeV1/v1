
	<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
	<html xmlns="http://www.w3.org/1999/xhtml">
	
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />	
		<title>V1 Script - Threads</title>
		<link rel="stylesheet" type="text/css" href="css/style.css" />
	</head>
	
	<body>
	
	<div class="logo"><a href="index.html"><img src="images/v1_logo.png" alt="V1 Script"/></a></div>
	
	<div class="page_wrap">
	<h1>Example: Working with threads</h1>
<p>The follwing <a href="thread-functions.html">thread functions</a> can be used to work with system threads.
On Linux posix threads will be created. </p>
<pre><code><span style="color: #000000"></span><span style="color: #0000BB;">&lt;?</span><span style="color: #000000">v1<br /><br /></span><span style="color: #0000BB;">function&nbsp;</span><span style="color: #000000">myThreadFunction&nbsp;</span><span style="color: #0000BB;">(</span><span style="color: #000000">param</span><span style="color: #0000BB;">)&nbsp;&nbsp;{<br />&nbsp;&nbsp;print&nbsp;(</span><span style="color: #DD0000">"I&nbsp;am&nbsp;running&nbsp;and&nbsp;got&nbsp;the&nbsp;param&nbsp;"</span><span style="color: #0000BB;">,&nbsp;</span><span style="color: #000000">param</span><span style="color: #0000BB;">);<br />}<br /><br /></span><span style="color: #008000">//&nbsp;Create&nbsp;new&nbsp;thread<br /></span><span style="color: #000000">param&nbsp;</span><span style="color: #0000BB;">=&nbsp;</span><span style="color: #000000">1</span><span style="color: #0000BB;">;<br /></span><span style="color: #000000">t&nbsp;</span><span style="color: #0000BB;">=&nbsp;</span><span style="color: #000000">thread_create&nbsp;</span><span style="color: #0000BB;">(</span><span style="color: #DD0000">"myThreadFunction"</span><span style="color: #0000BB;">,&nbsp;</span><span style="color: #000000">param</span><span style="color: #0000BB;">);&nbsp;<br /></span><span style="color: #000000">thread_start&nbsp;</span><span style="color: #0000BB;">(</span><span style="color: #000000">t</span><span style="color: #0000BB;">,&nbsp;</span><span style="color: #000000">false</span><span style="color: #0000BB;">);&nbsp;</span><span style="color: #008000">//&nbsp;false&nbsp;=&nbsp;dont&nbsp;wait&nbsp;until&nbsp;the&nbsp;thread&nbsp;is&nbsp;running<br /></span><span style="color: #000000">thread_join&nbsp;</span><span style="color: #0000BB;">(</span><span style="color: #000000">t</span><span style="color: #0000BB;">);&nbsp;</span><span style="color: #008000">//&nbsp;Wait&nbsp;until&nbsp;the&nbsp;thread&nbsp;is&nbsp;finished<br /><br /></span><span style="color: #000000">?&gt;</span></code></pre>
<p>Example: Send a signal to a thread.</p>
<pre><code><span style="color: #000000"></span><span style="color: #0000BB;">&lt;?</span><span style="color: #000000">v1<br /><br /></span><span style="color: #0000BB;">function&nbsp;</span><span style="color: #000000">myThreadFunction&nbsp;</span><span style="color: #0000BB;">(</span><span style="color: #000000">param</span><span style="color: #0000BB;">)&nbsp;&nbsp;{<br />&nbsp;&nbsp;print&nbsp;(</span><span style="color: #DD0000">"I&nbsp;am&nbsp;running&nbsp;and&nbsp;got&nbsp;the&nbsp;param&nbsp;"</span><span style="color: #0000BB;">,&nbsp;</span><span style="color: #000000">param</span><span style="color: #0000BB;">);<br />&nbsp;&nbsp;</span><span style="color: #000000">thread_wait&nbsp;</span><span style="color: #0000BB;">();&nbsp;</span><span style="color: #008000">//&nbsp;Wait&nbsp;until&nbsp;a&nbsp;thread_signal()&nbsp;accours<br />&nbsp;&nbsp;</span><span style="color: #0000BB;">print&nbsp;(</span><span style="color: #DD0000">"I&nbsp;am&nbsp;awake"</span><span style="color: #0000BB;">);<br />}<br /><br /></span><span style="color: #008000">//&nbsp;Create&nbsp;new&nbsp;thread<br /></span><span style="color: #000000">param&nbsp;</span><span style="color: #0000BB;">=&nbsp;</span><span style="color: #000000">1</span><span style="color: #0000BB;">;<br /></span><span style="color: #000000">t&nbsp;</span><span style="color: #0000BB;">=&nbsp;</span><span style="color: #000000">thread_create&nbsp;</span><span style="color: #0000BB;">(</span><span style="color: #DD0000">"myThreadFunction"</span><span style="color: #0000BB;">,&nbsp;</span><span style="color: #000000">param</span><span style="color: #0000BB;">);&nbsp;<br /></span><span style="color: #000000">thread_start&nbsp;</span><span style="color: #0000BB;">(</span><span style="color: #000000">t</span><span style="color: #0000BB;">);<br /><br /></span><span style="color: #000000">sleep&nbsp;</span><span style="color: #0000BB;">(</span><span style="color: #000000">1000</span><span style="color: #0000BB;">);&nbsp;</span><span style="color: #008000">//&nbsp;Wait&nbsp;1000&nbsp;milliseconds<br /></span><span style="color: #000000">thread_signal&nbsp;</span><span style="color: #0000BB;">(</span><span style="color: #000000">t</span><span style="color: #0000BB;">);&nbsp;</span><span style="color: #008000">//&nbsp;Signal&nbsp;the&nbsp;thread&nbsp;to&nbsp;weakup<br /></span><span style="color: #000000">thread_join&nbsp;</span><span style="color: #0000BB;">(</span><span style="color: #000000">t</span><span style="color: #0000BB;">);&nbsp;&nbsp;</span><span style="color: #008000">//&nbsp;Wait&nbsp;until&nbsp;the&nbsp;thread&nbsp;is&nbsp;finished<br /><br /></span><span style="color: #000000">?&gt;</span></code></pre>
<p>Example: Synchronize a global variable by different threads.</p>
<pre><code><span style="color: #000000"></span><span style="color: #0000BB;">&lt;?</span><span style="color: #000000">v1<br /><br />globalVar&nbsp;</span><span style="color: #0000BB;">=&nbsp;</span><span style="color: #000000">0</span><span style="color: #0000BB;">;<br /></span><span style="color: #000000">threadIdList&nbsp;</span><span style="color: #0000BB;">=&nbsp;[];<br /><br />function&nbsp;</span><span style="color: #000000">myThreadFunction&nbsp;</span><span style="color: #0000BB;">()&nbsp;{<br />&nbsp;&nbsp;</span><span style="color: #008000">//&nbsp;Threads&nbsp;can&nbsp;only&nbsp;write&nbsp;global&nbsp;variables,&nbsp;reference&nbsp;parameters&nbsp;are&nbsp;not&nbsp;possible<br />&nbsp;&nbsp;</span><span style="color: #0000BB;">global&nbsp;</span><span style="color: #000000">globalVar</span><span style="color: #0000BB;">;<br /><br />&nbsp;&nbsp;for&nbsp;(</span><span style="color: #000000">i</span><span style="color: #0000BB;">=</span><span style="color: #000000">0</span><span style="color: #0000BB;">;</span><span style="color: #000000">i</span><span style="color: #0000BB;">&lt;</span><span style="color: #000000">1000</span><span style="color: #0000BB;">;</span><span style="color: #000000">i</span><span style="color: #0000BB;">++)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">thread_sync_enter&nbsp;</span><span style="color: #0000BB;">();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000">//&nbsp;This&nbsp;variale&nbsp;has&nbsp;exclusive&nbsp;access&nbsp;by&nbsp;current&nbsp;thread&nbsp;because&nbsp;it&nbsp;is&nbsp;within&nbsp;thread_sync_enter()&nbsp;and&nbsp;thread_sync_leave()<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">globalVar&nbsp;</span><span style="color: #0000BB;">=&nbsp;</span><span style="color: #000000">time&nbsp;</span><span style="color: #0000BB;">();<br />&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;(</span><span style="color: #DD0000">"gobalVar&nbsp;=&nbsp;"</span><span style="color: #0000BB;">,&nbsp;</span><span style="color: #000000">globalVar</span><span style="color: #0000BB;">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">thread_sync_leave&nbsp;</span><span style="color: #0000BB;">();&nbsp;&nbsp;<br />&nbsp;&nbsp;}<br />}<br /><br /></span><span style="color: #008000">//&nbsp;Create&nbsp;many&nbsp;threads<br /></span><span style="color: #0000BB;">for&nbsp;(</span><span style="color: #000000">threadIdx</span><span style="color: #0000BB;">=</span><span style="color: #000000">0</span><span style="color: #0000BB;">;</span><span style="color: #000000">threadIdx</span><span style="color: #0000BB;">&lt;</span><span style="color: #000000">10</span><span style="color: #0000BB;">;</span><span style="color: #000000">threadIdx</span><span style="color: #0000BB;">++)&nbsp;{<br />&nbsp;&nbsp;</span><span style="color: #000000">threadIdList</span><span style="color: #0000BB;">[</span><span style="color: #000000">threadIdx</span><span style="color: #0000BB;">]&nbsp;=&nbsp;</span><span style="color: #000000">thread_create&nbsp;</span><span style="color: #0000BB;">(</span><span style="color: #DD0000">"myThreadFunction"</span><span style="color: #0000BB;">);<br />&nbsp;&nbsp;</span><span style="color: #000000">thread_start&nbsp;</span><span style="color: #0000BB;">(</span><span style="color: #000000">threadIdList</span><span style="color: #0000BB;">[</span><span style="color: #000000">threadIdx</span><span style="color: #0000BB;">]);<br />}<br /><br /></span><span style="color: #008000">//&nbsp;Wait&nbsp;until&nbsp;all&nbsp;threads&nbsp;are&nbsp;finished<br /></span><span style="color: #0000BB;">for&nbsp;(</span><span style="color: #000000">threadIdx</span><span style="color: #0000BB;">=</span><span style="color: #000000">0</span><span style="color: #0000BB;">;</span><span style="color: #000000">threadIdx</span><span style="color: #0000BB;">&lt;</span><span style="color: #000000">10</span><span style="color: #0000BB;">;</span><span style="color: #000000">threadIdx</span><span style="color: #0000BB;">++)&nbsp;{<br />&nbsp;&nbsp;if&nbsp;(</span><span style="color: #000000">threadIdList</span><span style="color: #0000BB;">[</span><span style="color: #000000">threadIdx</span><span style="color: #0000BB;">])<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #000000">thread_join&nbsp;</span><span style="color: #0000BB;">(</span><span style="color: #000000">threadIdList</span><span style="color: #0000BB;">[</span><span style="color: #000000">threadIdx</span><span style="color: #0000BB;">]);<br />}<br /><br /></span><span style="color: #000000">?&gt;</span></code></pre>
<p><a href="index.html">back to Home</a></p>
	</div>
	<footer>
		<p>V1 Version 0.96 - Documentation generated Wed, 01 May 2024 12:45</p>
	</footer>
	</body>
	</html>
	
	